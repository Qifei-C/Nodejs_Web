{"ast":null,"code":"/**\n * Module dependencies\n */\nvar debug = require('debug')('jsonp');\n/**\n * Module exports.\n */\n\n\nmodule.exports = jsonp;\n/**\n * Callback index.\n */\n\nvar count = 0;\n/**\n * Noop function.\n */\n\nfunction noop() {}\n/**\n * JSONP handler\n *\n * Options:\n *  - param {String} qs parameter (`callback`)\n *  - prefix {String} qs parameter (`__jp`)\n *  - name {String} qs parameter (`prefix` + incr)\n *  - timeout {Number} how long after a timeout error is emitted (`60000`)\n *\n * @param {String} url\n * @param {Object|Function} optional options / callback\n * @param {Function} optional callback\n */\n\n\nfunction jsonp(url, opts, fn) {\n  if ('function' == typeof opts) {\n    fn = opts;\n    opts = {};\n  }\n\n  if (!opts) opts = {};\n  var prefix = opts.prefix || '__jp'; // use the callback name that was passed if one was provided.\n  // otherwise generate a unique name by incrementing our counter.\n\n  var id = opts.name || prefix + count++;\n  var param = opts.param || 'callback';\n  var timeout = null != opts.timeout ? opts.timeout : 60000;\n  var enc = encodeURIComponent;\n  var target = document.getElementsByTagName('script')[0] || document.head;\n  var script;\n  var timer;\n\n  if (timeout) {\n    timer = setTimeout(function () {\n      cleanup();\n      if (fn) fn(new Error('Timeout'));\n    }, timeout);\n  }\n\n  function cleanup() {\n    if (script.parentNode) script.parentNode.removeChild(script);\n    window[id] = noop;\n    if (timer) clearTimeout(timer);\n  }\n\n  function cancel() {\n    if (window[id]) {\n      cleanup();\n    }\n  }\n\n  window[id] = function (data) {\n    debug('jsonp got', data);\n    cleanup();\n    if (fn) fn(null, data);\n  }; // add qs component\n\n\n  url += (~url.indexOf('?') ? '&' : '?') + param + '=' + enc(id);\n  url = url.replace('?&', '?');\n  debug('jsonp req \"%s\"', url); // create script\n\n  script = document.createElement('script');\n  script.src = url;\n  target.parentNode.insertBefore(script, target);\n  return cancel;\n}","map":{"version":3,"names":["debug","require","module","exports","jsonp","count","noop","url","opts","fn","prefix","id","name","param","timeout","enc","encodeURIComponent","target","document","getElementsByTagName","head","script","timer","setTimeout","cleanup","Error","parentNode","removeChild","window","clearTimeout","cancel","data","indexOf","replace","createElement","src","insertBefore"],"sources":["/Users/qifei/website/PersonalWebsite/node_modules/jsonp/index.js"],"sourcesContent":["/**\n * Module dependencies\n */\n\nvar debug = require('debug')('jsonp');\n\n/**\n * Module exports.\n */\n\nmodule.exports = jsonp;\n\n/**\n * Callback index.\n */\n\nvar count = 0;\n\n/**\n * Noop function.\n */\n\nfunction noop(){}\n\n/**\n * JSONP handler\n *\n * Options:\n *  - param {String} qs parameter (`callback`)\n *  - prefix {String} qs parameter (`__jp`)\n *  - name {String} qs parameter (`prefix` + incr)\n *  - timeout {Number} how long after a timeout error is emitted (`60000`)\n *\n * @param {String} url\n * @param {Object|Function} optional options / callback\n * @param {Function} optional callback\n */\n\nfunction jsonp(url, opts, fn){\n  if ('function' == typeof opts) {\n    fn = opts;\n    opts = {};\n  }\n  if (!opts) opts = {};\n\n  var prefix = opts.prefix || '__jp';\n\n  // use the callback name that was passed if one was provided.\n  // otherwise generate a unique name by incrementing our counter.\n  var id = opts.name || (prefix + (count++));\n\n  var param = opts.param || 'callback';\n  var timeout = null != opts.timeout ? opts.timeout : 60000;\n  var enc = encodeURIComponent;\n  var target = document.getElementsByTagName('script')[0] || document.head;\n  var script;\n  var timer;\n\n\n  if (timeout) {\n    timer = setTimeout(function(){\n      cleanup();\n      if (fn) fn(new Error('Timeout'));\n    }, timeout);\n  }\n\n  function cleanup(){\n    if (script.parentNode) script.parentNode.removeChild(script);\n    window[id] = noop;\n    if (timer) clearTimeout(timer);\n  }\n\n  function cancel(){\n    if (window[id]) {\n      cleanup();\n    }\n  }\n\n  window[id] = function(data){\n    debug('jsonp got', data);\n    cleanup();\n    if (fn) fn(null, data);\n  };\n\n  // add qs component\n  url += (~url.indexOf('?') ? '&' : '?') + param + '=' + enc(id);\n  url = url.replace('?&', '?');\n\n  debug('jsonp req \"%s\"', url);\n\n  // create script\n  script = document.createElement('script');\n  script.src = url;\n  target.parentNode.insertBefore(script, target);\n\n  return cancel;\n}\n"],"mappings":"AAAA;AACA;AACA;AAEA,IAAIA,KAAK,GAAGC,OAAO,CAAC,OAAD,CAAP,CAAiB,OAAjB,CAAZ;AAEA;AACA;AACA;;;AAEAC,MAAM,CAACC,OAAP,GAAiBC,KAAjB;AAEA;AACA;AACA;;AAEA,IAAIC,KAAK,GAAG,CAAZ;AAEA;AACA;AACA;;AAEA,SAASC,IAAT,GAAe,CAAE;AAEjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA,SAASF,KAAT,CAAeG,GAAf,EAAoBC,IAApB,EAA0BC,EAA1B,EAA6B;EAC3B,IAAI,cAAc,OAAOD,IAAzB,EAA+B;IAC7BC,EAAE,GAAGD,IAAL;IACAA,IAAI,GAAG,EAAP;EACD;;EACD,IAAI,CAACA,IAAL,EAAWA,IAAI,GAAG,EAAP;EAEX,IAAIE,MAAM,GAAGF,IAAI,CAACE,MAAL,IAAe,MAA5B,CAP2B,CAS3B;EACA;;EACA,IAAIC,EAAE,GAAGH,IAAI,CAACI,IAAL,IAAcF,MAAM,GAAIL,KAAK,EAAtC;EAEA,IAAIQ,KAAK,GAAGL,IAAI,CAACK,KAAL,IAAc,UAA1B;EACA,IAAIC,OAAO,GAAG,QAAQN,IAAI,CAACM,OAAb,GAAuBN,IAAI,CAACM,OAA5B,GAAsC,KAApD;EACA,IAAIC,GAAG,GAAGC,kBAAV;EACA,IAAIC,MAAM,GAAGC,QAAQ,CAACC,oBAAT,CAA8B,QAA9B,EAAwC,CAAxC,KAA8CD,QAAQ,CAACE,IAApE;EACA,IAAIC,MAAJ;EACA,IAAIC,KAAJ;;EAGA,IAAIR,OAAJ,EAAa;IACXQ,KAAK,GAAGC,UAAU,CAAC,YAAU;MAC3BC,OAAO;MACP,IAAIf,EAAJ,EAAQA,EAAE,CAAC,IAAIgB,KAAJ,CAAU,SAAV,CAAD,CAAF;IACT,CAHiB,EAGfX,OAHe,CAAlB;EAID;;EAED,SAASU,OAAT,GAAkB;IAChB,IAAIH,MAAM,CAACK,UAAX,EAAuBL,MAAM,CAACK,UAAP,CAAkBC,WAAlB,CAA8BN,MAA9B;IACvBO,MAAM,CAACjB,EAAD,CAAN,GAAaL,IAAb;IACA,IAAIgB,KAAJ,EAAWO,YAAY,CAACP,KAAD,CAAZ;EACZ;;EAED,SAASQ,MAAT,GAAiB;IACf,IAAIF,MAAM,CAACjB,EAAD,CAAV,EAAgB;MACda,OAAO;IACR;EACF;;EAEDI,MAAM,CAACjB,EAAD,CAAN,GAAa,UAASoB,IAAT,EAAc;IACzB/B,KAAK,CAAC,WAAD,EAAc+B,IAAd,CAAL;IACAP,OAAO;IACP,IAAIf,EAAJ,EAAQA,EAAE,CAAC,IAAD,EAAOsB,IAAP,CAAF;EACT,CAJD,CAxC2B,CA8C3B;;;EACAxB,GAAG,IAAI,CAAC,CAACA,GAAG,CAACyB,OAAJ,CAAY,GAAZ,CAAD,GAAoB,GAApB,GAA0B,GAA3B,IAAkCnB,KAAlC,GAA0C,GAA1C,GAAgDE,GAAG,CAACJ,EAAD,CAA1D;EACAJ,GAAG,GAAGA,GAAG,CAAC0B,OAAJ,CAAY,IAAZ,EAAkB,GAAlB,CAAN;EAEAjC,KAAK,CAAC,gBAAD,EAAmBO,GAAnB,CAAL,CAlD2B,CAoD3B;;EACAc,MAAM,GAAGH,QAAQ,CAACgB,aAAT,CAAuB,QAAvB,CAAT;EACAb,MAAM,CAACc,GAAP,GAAa5B,GAAb;EACAU,MAAM,CAACS,UAAP,CAAkBU,YAAlB,CAA+Bf,MAA/B,EAAuCJ,MAAvC;EAEA,OAAOa,MAAP;AACD"},"metadata":{},"sourceType":"script"}