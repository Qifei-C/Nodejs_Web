{"ast":null,"code":"/**\n * Module dependencies\n */\n\nvar debug = require('debug')('jsonp');\n\n/**\n * Module exports.\n */\n\nmodule.exports = jsonp;\n\n/**\n * Callback index.\n */\n\nvar count = 0;\n\n/**\n * Noop function.\n */\n\nfunction noop() {}\n\n/**\n * JSONP handler\n *\n * Options:\n *  - param {String} qs parameter (`callback`)\n *  - prefix {String} qs parameter (`__jp`)\n *  - name {String} qs parameter (`prefix` + incr)\n *  - timeout {Number} how long after a timeout error is emitted (`60000`)\n *\n * @param {String} url\n * @param {Object|Function} optional options / callback\n * @param {Function} optional callback\n */\n\nfunction jsonp(url, opts, fn) {\n  if ('function' == typeof opts) {\n    fn = opts;\n    opts = {};\n  }\n  if (!opts) opts = {};\n  var prefix = opts.prefix || '__jp';\n\n  // use the callback name that was passed if one was provided.\n  // otherwise generate a unique name by incrementing our counter.\n  var id = opts.name || prefix + count++;\n  var param = opts.param || 'callback';\n  var timeout = null != opts.timeout ? opts.timeout : 60000;\n  var enc = encodeURIComponent;\n  var target = document.getElementsByTagName('script')[0] || document.head;\n  var script;\n  var timer;\n  if (timeout) {\n    timer = setTimeout(function () {\n      cleanup();\n      if (fn) fn(new Error('Timeout'));\n    }, timeout);\n  }\n  function cleanup() {\n    if (script.parentNode) script.parentNode.removeChild(script);\n    window[id] = noop;\n    if (timer) clearTimeout(timer);\n  }\n  function cancel() {\n    if (window[id]) {\n      cleanup();\n    }\n  }\n  window[id] = function (data) {\n    debug('jsonp got', data);\n    cleanup();\n    if (fn) fn(null, data);\n  };\n\n  // add qs component\n  url += (~url.indexOf('?') ? '&' : '?') + param + '=' + enc(id);\n  url = url.replace('?&', '?');\n  debug('jsonp req \"%s\"', url);\n\n  // create script\n  script = document.createElement('script');\n  script.src = url;\n  target.parentNode.insertBefore(script, target);\n  return cancel;\n}","map":{"version":3,"names":["debug","require","module","exports","jsonp","count","noop","url","opts","fn","prefix","id","name","param","timeout","enc","encodeURIComponent","target","document","getElementsByTagName","head","script","timer","setTimeout","cleanup","Error","parentNode","removeChild","window","clearTimeout","cancel","data","indexOf","replace","createElement","src","insertBefore"],"sources":["/Users/qifei/qifei-port/node_modules/jsonp/index.js"],"sourcesContent":["/**\n * Module dependencies\n */\n\nvar debug = require('debug')('jsonp');\n\n/**\n * Module exports.\n */\n\nmodule.exports = jsonp;\n\n/**\n * Callback index.\n */\n\nvar count = 0;\n\n/**\n * Noop function.\n */\n\nfunction noop(){}\n\n/**\n * JSONP handler\n *\n * Options:\n *  - param {String} qs parameter (`callback`)\n *  - prefix {String} qs parameter (`__jp`)\n *  - name {String} qs parameter (`prefix` + incr)\n *  - timeout {Number} how long after a timeout error is emitted (`60000`)\n *\n * @param {String} url\n * @param {Object|Function} optional options / callback\n * @param {Function} optional callback\n */\n\nfunction jsonp(url, opts, fn){\n  if ('function' == typeof opts) {\n    fn = opts;\n    opts = {};\n  }\n  if (!opts) opts = {};\n\n  var prefix = opts.prefix || '__jp';\n\n  // use the callback name that was passed if one was provided.\n  // otherwise generate a unique name by incrementing our counter.\n  var id = opts.name || (prefix + (count++));\n\n  var param = opts.param || 'callback';\n  var timeout = null != opts.timeout ? opts.timeout : 60000;\n  var enc = encodeURIComponent;\n  var target = document.getElementsByTagName('script')[0] || document.head;\n  var script;\n  var timer;\n\n\n  if (timeout) {\n    timer = setTimeout(function(){\n      cleanup();\n      if (fn) fn(new Error('Timeout'));\n    }, timeout);\n  }\n\n  function cleanup(){\n    if (script.parentNode) script.parentNode.removeChild(script);\n    window[id] = noop;\n    if (timer) clearTimeout(timer);\n  }\n\n  function cancel(){\n    if (window[id]) {\n      cleanup();\n    }\n  }\n\n  window[id] = function(data){\n    debug('jsonp got', data);\n    cleanup();\n    if (fn) fn(null, data);\n  };\n\n  // add qs component\n  url += (~url.indexOf('?') ? '&' : '?') + param + '=' + enc(id);\n  url = url.replace('?&', '?');\n\n  debug('jsonp req \"%s\"', url);\n\n  // create script\n  script = document.createElement('script');\n  script.src = url;\n  target.parentNode.insertBefore(script, target);\n\n  return cancel;\n}\n"],"mappings":"AAAA;AACA;AACA;;AAEA,IAAIA,KAAK,GAAGC,OAAO,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC;;AAErC;AACA;AACA;;AAEAC,MAAM,CAACC,OAAO,GAAGC,KAAK;;AAEtB;AACA;AACA;;AAEA,IAAIC,KAAK,GAAG,CAAC;;AAEb;AACA;AACA;;AAEA,SAASC,IAAIA,CAAA,EAAE,CAAC;;AAEhB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASF,KAAKA,CAACG,GAAG,EAAEC,IAAI,EAAEC,EAAE,EAAC;EAC3B,IAAI,UAAU,IAAI,OAAOD,IAAI,EAAE;IAC7BC,EAAE,GAAGD,IAAI;IACTA,IAAI,GAAG,CAAC,CAAC;EACX;EACA,IAAI,CAACA,IAAI,EAAEA,IAAI,GAAG,CAAC,CAAC;EAEpB,IAAIE,MAAM,GAAGF,IAAI,CAACE,MAAM,IAAI,MAAM;;EAElC;EACA;EACA,IAAIC,EAAE,GAAGH,IAAI,CAACI,IAAI,IAAKF,MAAM,GAAIL,KAAK,EAAI;EAE1C,IAAIQ,KAAK,GAAGL,IAAI,CAACK,KAAK,IAAI,UAAU;EACpC,IAAIC,OAAO,GAAG,IAAI,IAAIN,IAAI,CAACM,OAAO,GAAGN,IAAI,CAACM,OAAO,GAAG,KAAK;EACzD,IAAIC,GAAG,GAAGC,kBAAkB;EAC5B,IAAIC,MAAM,GAAGC,QAAQ,CAACC,oBAAoB,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,IAAID,QAAQ,CAACE,IAAI;EACxE,IAAIC,MAAM;EACV,IAAIC,KAAK;EAGT,IAAIR,OAAO,EAAE;IACXQ,KAAK,GAAGC,UAAU,CAAC,YAAU;MAC3BC,OAAO,CAAC,CAAC;MACT,IAAIf,EAAE,EAAEA,EAAE,CAAC,IAAIgB,KAAK,CAAC,SAAS,CAAC,CAAC;IAClC,CAAC,EAAEX,OAAO,CAAC;EACb;EAEA,SAASU,OAAOA,CAAA,EAAE;IAChB,IAAIH,MAAM,CAACK,UAAU,EAAEL,MAAM,CAACK,UAAU,CAACC,WAAW,CAACN,MAAM,CAAC;IAC5DO,MAAM,CAACjB,EAAE,CAAC,GAAGL,IAAI;IACjB,IAAIgB,KAAK,EAAEO,YAAY,CAACP,KAAK,CAAC;EAChC;EAEA,SAASQ,MAAMA,CAAA,EAAE;IACf,IAAIF,MAAM,CAACjB,EAAE,CAAC,EAAE;MACda,OAAO,CAAC,CAAC;IACX;EACF;EAEAI,MAAM,CAACjB,EAAE,CAAC,GAAG,UAASoB,IAAI,EAAC;IACzB/B,KAAK,CAAC,WAAW,EAAE+B,IAAI,CAAC;IACxBP,OAAO,CAAC,CAAC;IACT,IAAIf,EAAE,EAAEA,EAAE,CAAC,IAAI,EAAEsB,IAAI,CAAC;EACxB,CAAC;;EAED;EACAxB,GAAG,IAAI,CAAC,CAACA,GAAG,CAACyB,OAAO,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,IAAInB,KAAK,GAAG,GAAG,GAAGE,GAAG,CAACJ,EAAE,CAAC;EAC9DJ,GAAG,GAAGA,GAAG,CAAC0B,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC;EAE5BjC,KAAK,CAAC,gBAAgB,EAAEO,GAAG,CAAC;;EAE5B;EACAc,MAAM,GAAGH,QAAQ,CAACgB,aAAa,CAAC,QAAQ,CAAC;EACzCb,MAAM,CAACc,GAAG,GAAG5B,GAAG;EAChBU,MAAM,CAACS,UAAU,CAACU,YAAY,CAACf,MAAM,EAAEJ,MAAM,CAAC;EAE9C,OAAOa,MAAM;AACf"},"metadata":{},"sourceType":"script"}